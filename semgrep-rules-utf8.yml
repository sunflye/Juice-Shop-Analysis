rules:
  - id: js-innerhtml-xss
    languages: [javascript]
    message: "(CWE-79)"
    severity: ERROR
    patterns:
      - pattern: $OBJ.innerHTML = $VAL
  
  - id: js-eval-usage
    languages: [javascript]
    message: "(CWE-94/98)"
    severity: ERROR
    patterns:
      - pattern: eval(...)
  
  - id: js-document-write-xss
    languages: [javascript]
    message: "(CWE-79)"
    severity: WARNING
    patterns:
      - pattern: document.write(...)
  
  - id: log-secret
    languages: [javascript]
    message: "(CWE-532)"
    severity: WARNING
    patterns:
      - pattern: console.log($VAR)
      - metavariable-regex:
          metavariable: $VAR
          regex: ".*(secret|password|token|key|api).*"
  
  - id: missing-csrf-protection
    languages: [javascript]
    message: "(CWE-352)"
    severity: WARNING
    patterns:
      - pattern: app.use($MIDDLEWARE)
      - metavariable-regex:
          metavariable: $MIDDLEWARE
          regex: "((?!csurf).)*$"

  - id: possible-idor-basket
    languages: [javascript, typescript]
    message: "(CWE-639) Possible IDOR"
    severity: WARNING
    patterns:
      - pattern-either:
          - pattern: |
              const $B = $REQ.body.BasketId
          - pattern: |
              let $B = $REQ.body.BasketId
          - pattern: |
              var $B = $REQ.body.BasketId
          - pattern: |
              const $B = $REQ.body.id
          - pattern: |
              let $B = $REQ.body.id
          - pattern: |
              var $B = $REQ.body.id
          - pattern: |
              const $B = $REQ.query.BasketId
          - pattern: |
              const $B = $REQ.query.id
          - pattern: |
              $MODEL.findAll({ where: { BasketId: $REQ.body.BasketId } })
          - pattern: |
              $MODEL.findAll({ where: { BasketId: $REQ.body.id } })
          - pattern: |
              $MODEL.findAll({ where: { id: $REQ.query.id } })